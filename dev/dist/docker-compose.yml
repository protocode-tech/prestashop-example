version: '3'
services:
    app:
        image: 'prestashop/prestashop:8.0.1'
        environment:
            VIRTUAL_HOST: app-${COMPOSE_PROJECT_NAME}.local
            PS_DEV_MODE: '1'
            PS_INSTALL_AUTO: '0'
            PS_ENABLE_SSL: '1'
            DB_SERVER: $DB_HOST
            DB_NAME: $DB_DATABASE
            DB_USER: $DB_USER
            DB_PASSWD: $DB_PASSWORD
            DB_PREFIX: $DB_PREFIX
        volumes:
            - './:/var/www/html'
        links:
            - database
            - mailhog
        networks:
            - protocode_default
    database:
        image: 'mysql:5.7'
        environment:
            MYSQL_DATABASE: $DB_DATABASE
            MYSQL_USER: $DB_USER
            MYSQL_PASSWORD: $DB_PASSWORD
            MYSQL_ROOT_PASSWORD: $DB_PASSWORD
        volumes:
            - db-data:/var/lib/mysql
        networks:
            - protocode_default
    phpmyadmin:
        image: 'phpmyadmin:5.0'
        environment:
            VIRTUAL_HOST: phpmyadmin-${COMPOSE_PROJECT_NAME}.local
            MYSQL_USERNAME: $DB_USER
            MYSQL_PASSWORD: $DB_PASSWORD
            PMA_USERNAME: $DB_USER
            PMA_PASSWORD: $DB_PASSWORD
            PMA_HOSTS: $DB_HOST
        links:
            - database
        networks:
            - protocode_default
    mailhog:
        image: mailhog/mailhog
        environment:
            VIRTUAL_HOST: mailhog-${COMPOSE_PROJECT_NAME}.local
            VIRTUAL_PORT: '8025'
        networks:
            - protocode_default
volumes:
    db-data:
networks:
    protocode_default:
        external: true
